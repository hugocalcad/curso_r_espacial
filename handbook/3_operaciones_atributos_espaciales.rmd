# Operaciones con atributos espaciales en R

## Datos Vector

Utilizando los datos cargados anteriormente:

```{r, eval = FALSE}
shape_files <- list.files('../recursos/shps', full.names = T, pattern = '.shp$')
sf_dep <- st_read(shape_files[2], stringsAsFactors = F)
sf_duc <- st_read(shape_files[3], stringsAsFactors = F)
sf_pob <- st_read(shape_files[4], stringsAsFactors = F)
```

Si observamos nuestro feauture que representa departamentos de Bolivia:

```{r}
as.data.frame(sf_dep)
```

Existen columnas que no snecesitan para trabajar los cuales son : *gml_id*, *OBJECTID* e *ID*, y tambien existen filas que no corresponden a los departamentos si a lagos y salares, para poder seleccionar tanto columnas datos como columnas existen varios métodos a continuacion se describen algunos:

### Utilizando la funcion *subset*

Se puede utilizar la función subset y una condición en la columna y/o columnas que se necesita hacer la selección.

```{r}
#Filtrar solo los departamentos
sf_dep_fil <- subset(sf_dep, DESCRIP == "Departamento")
#Verificar el filtrado
as.data.frame(sf_dep_fil)
```

Como se puede observar selecciona solo aquellas filas que en la columna *DESCRIP* coincide con la cadena '*Departamento*'. utilizando la opcion *select* se seleccionar solo con las columnas que queremos trabajar:

```{r}
#Filtrar por  departamentos con las columnas COD_DEP, NOMDEP y geometry
sf_dep_fil <- subset(sf_dep, DESCRIP == "Departamento",
                     select = c(COD_DEP, NOM_DEP, geometry))
#Verificar el filtrado
as.data.frame(sf_dep_fil)
```

### Utilizando los corchetes

Otra forma practica para hacer seleccion de nuestro datos es la utilizacion de indices dentro de los corchetes realizando las mismas operaciones pero con corchetes.

```{r}
#Filtrar solo los departamentos
sf_dep_fil <- sf_dep[sf_dep$DESCRIP == "Departamento",]
#Verificar el filtrado
as.data.frame(sf_dep_fil)
```

Seleccionando las columnas

```{r}
#Filtrar las columnas con indices las posiciones que utilizamos son: 
# columnas 4,5 y 7
sf_dep_fil <- sf_dep_fil[, c(4,5,7)]
as.data.frame(sf_dep_fil)
```

### Utilizando el paquete *dplyr*

El paquete ***dplyr*** ofrece varias funciones que nos ayuda a analizar y manipular nuestros datos,funciona bastante bien cuando trabajamos con una gran cantidad de datos, acontinuación mostramos como se intala.

```{r, eval= FALSE}
if(!require(dplyr))
  install.packages('dplyr')
library(dplyr)
```

Utilizando los pipelines (*%>%*) podemos ordenar nuestro código utilizando pirmero la funcion *filter()* que sirve para seleccionar las filas según uno o varios criterio similar a la funcion *subset* y posteriormente utilizamos la funcion select para seleccionar las columnas, aca no es necesario colocar la columna de geometria este se mantendra.

```{r}
#Utilizando las funciones con pipeline
sf_dep_fil <- sf_dep %>% 
  filter(DESCRIP == "Departamento") %>% 
  select(NOM_DEP)
#Mostrar el resultado
as.data.frame(sf_dep_fil)
```

##Raster

Como hemos visto en el capitulo anterior para acceder a los datos de un raster solo es necesario utilizar losindices dentro los corchetes, ya que una imagen raster es una matriz ubicados espacialmente.

Pero muchas veces necestamos extraer datos de ciertos punto o sectores por ejemplosi tuvieramos un raster de elevación y tenemos puntos de poblaciones y queremos saber a que altura se encuantran hay que extraer esto datos, y para esto tenemos la función *extract* del R.

```{r}
#Utilizando la capa con las 3 bandas y la capa de poblaciones extrraemos 
rasValue <- extract(ras_S, sf_pob)
#verificamos los datos con head y tail
head(rasValue)
tail(rasValue)
```

Como se observa los datos aparecen con valores *NA* esto es debido a que nuestro raster ocupa solo el espacio de santa cruz y las poblaciones de toda bolivia podemos utilizar un filtro para dejar de lado los valores *NA*

````{r}
#Lo convertimos en un data frame
rasValue <- as.data.frame(rasValue)
#Realisamos el filtro solo de la primera banda ya que se repetira en las demas
rasValue %>% filter(!is.na(rasValue$Santa_Cruz_2.1))
#Revisamos los datos
head(rasValue)
tail(rasValue)
```